<lift:surround with="default" at="content">
  <h2>Welcome to your project!</h2>
  <p>

    <script type="text/javascript">
      function publishCode() {
        var id   = $("#__ID__").text();
        var code = editAreaLoader.getValue("editorpane");
        //console.log("ID = " + id  + ", CODE = " + code);
        $.post("/publish", { "id" : id, "code" : code });
      }

      var shouldPush = false;
      setInterval(function() {
        if (shouldPush) {
          publishCode();
          shouldPush = false;
        }
      }, 2000);

      $(document).ready(function() {
        withEditorPaneWindow(function(win) {
          $(win.document).ready(function() {
            $(win.document.getElementById("textarea")).keypress(function() {
              //console.log("KEY PRESSED");
              shouldPush = true;
            });
          });
        });
      });

      $(document).ready(function() {
        $("#compile").click(function() { publishCode(); });
      });
    </script>
    <lift:comet type="CollabEditor">
      <e:theID/>
      <e:textbox/>
      <button id="compile">Compile</button>
      <e:run/> 
      <div id="console"/>
      <e:stdin/>
    </lift:comet>
  </p>

</lift:surround>
